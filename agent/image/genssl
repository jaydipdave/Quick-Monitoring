
#!/bin/sh

domain=$1

country=CA
commonname=$domain
state=Quebec
locality=Montreal
organization="QuickMonitoring Agent"
organizationalunit=AG
email=nobody@some-random-domain.com

password=doesntmatter

SSL_PATH="/etc/ssl"


#Generate a key
openssl genrsa -des3 -passout pass:$password -out $SSL_PATH/$domain.key 2048 -noout

#Remove passphrase from the key. Comment the line out to keep the passphrase
openssl rsa -in $SSL_PATH/$domain.key -passin pass:$password  -out $SSL_PATH/$domain.key

#Generate CSR
openssl req -new -key $SSL_PATH/$domain.key -out $SSL_PATH/$domain.csr -passin pass:$password \
    -subj "/C=$country/ST=$state/L=$locality/O=$organization/OU=$organizationalunit/CN=$commonname/emailAddress=$email"

#Generate Certificate
openssl x509 -req -days 3650 -in $SSL_PATH/$domain.csr -signkey $SSL_PATH/$domain.key -out $SSL_PATH/$domain.crt